workflow:
    rules:
    - if: $CI_COMMIT_BRANCH != "khaldoun" && $CI_PIPELINE_SOURCE != "merge-request-event" 
      when: never
    - when: always
stages:
    - clean
    - build
    - test



lint_job:
    stage: clean
    tags: 
        - windows
        - local 
    cache:
        key: "$CI_COMMIT_REF_NAME"
        paths:
            - "node_modules"
        policy: pull-push
    before_script:
        - npm install
    script:
        - echo "formatting code"
        - npm run format
        - echo "linting code"
        - npm run lint




run_unit_tests:
    stage: test
    coverage: /All files[^|]*\|[^|]*\s+([\d\.]+)/
    needs:
        - lint_job
    tags:
        - local
        - windows
    before_script:
        - npm install
    script:
        - npm run test:report | Select-String -Pattern 'All files\s+\|\s+([\d.]+)' | ForEach-Object { ($_ -split '\|')[1].Trim() }
    artifacts:
        when: always
        paths:
            - ./junit.xml
        reports:
            junit: ./junit.xml

